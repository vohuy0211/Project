<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="reviewProduct.css">
</head>

<body>
    <header>
        <div class="container text-center">
            <div class="row">
                <div class="col-sm-8">
                    <img src="./images/miacake-logo-web-01.png">
                </div>
                <div class="col-sm-4 search-box">
                    <div class="input-search">
                        <form class="d-flex" role="search">
                            <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                            <button class="btn btn-outline-success" type="submit">Search</button>
                        </form>
                    </div>
                </div>
            </div>

    </header>

    <div class="wrapper">
        <div class="d-flex p-2 navbar">
            <div class="container">

                <div class="menu">
                    <ul>
                        <li>
                            <a href="indexlg.html">TRANG CHỦ</a>
                        </li>
                    </ul>

                </div>
                <div class="main-menu">
                    <ul>
                        <li class="menu-item">
                            <a href="#">BÁNH SINH NHẬT<i class="fa-solid fa-angle-down fa-shake"
                                    style="color: #080404;"></i></a>
                            <ul class="menu-drop">
                                <li><a href="#">Bánh Sự Kiện</a></li>
                                <li><a href="#">Bộ Sưu Tập Bánh </a></li>
                                <li><a href="#">Bánh Theo Yêu Cầu</a></li>
                                <li><a href="#">Bánh Vẽ</a></li>
                                <li><a href="#">Bánh In Ảnh</a></li>
                            </ul>
                        </li>
                    </ul>
                    <ul>
                        <li class="menu-item-1">
                            <a href="#">BÁNH MÌ && BÁNH MẶN<i class="fa-solid fa-angle-down fa-shake"
                                    style="color: #000000;"></i></a>
                            <ul class="menu-drop-1">
                                <li><a href="#">BÁNH MÌ</a></li>
                                <li><a href="#">BÁNH MẶN</a></li>
                            </ul>
                        </li>
                    </ul>
                    <ul>
                        <li class="menu-item-2">
                            <a href="#">COOKIES && MINICAKE<i class="fa-solid fa-angle-down fa-shake"
                                    style="color: #000000;"></i></a>
                            <ul class="menu-drop-2">
                                <li><a href="#">COOKIES</a></li>
                                <li><a href="#">MINICAKE</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
                <div class="item-box">
                    <ul>
                        <li>
                            <i class="fa-solid fa-user fa-flip" style="color:#0c0075;"></i>
                            <a href="register.html">Tài khoản</a>
                        </li>
                    </ul>
                    <ul>
                        <li>
                            <a href="Cart.html"><i class="fa-solid fa-cart-plus fa-beat"
                                    style="color:#0c0075;"></i></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <section class="img-logo">
        <img src="./images/ms_banner_img5.webp" width="100%" id="img-item">
    </section>
    <section>
        <div class="main-header">
            <h1>Loại bánh phổ biến 2023</h1>
            <br>
            <br>

            <i class="fa-solid fa-cake-candles fa-bounce fa-2xl" style="color: #ff00bb;"></i>
        </div>
    </section>
    <br>
    <br>
    <div class="reviewProduct">
        <div>
            <div class="product-img">
                <img src="./images_product/product_1.webp" alt="" width="90%">
            </div>
        </div>
        <div>
            <h3>CARAMEL AND CHOCOLATE CAKE MOUSSE CHỮ NHẬT</h3>
            <p>Mã sản phẩm: BSN07</p>
            <p>Giá : 630.000 <sup>đ</sup></p>
            <div id="buy-amount">
                <input type="number" min="1" value="1" id="number-product" />
                <input type="text" name="amount" id="amount">
                <input type="number" min="1" value="1" id="number-product" />
            </div>
            <button class="btn-button" id="add-cart">Thêm vào giỏ hàng</button>
            <button class="btn-button-1">MUA NGAY</button>

            <div id="reviewCMT">
                <br>
                <a href="#">Mô tả chung</a>

                <p>- GATO</p>
                <p> - CARAMEL SOCOLA</p>
                <p></p> BÁNH ĐƯỢC LÀM TỪ 3 LỚP GATO KẾT HỢP VỚI LỚP CREAM CHEESE, CHANH LEO và CHOCOLATE . PHỦ MẶT BÁNH
                1</p>
                <p> LỚP SỐT CARAMEL VÀ TRANG TRÍ HOA QUẢ.</p>

            </div>

        </div>

    </div>
    <br>
    <br>
    <footer>
        <div class="row">
            <div class="col-lg-1">

            </div>
            <div class="col-lg-2">
                <img src="./images/logo-footer.webp">
                <br>
                <i class="fa-solid fa-house" style="color: #ffffff;"></i>
                Số 09 Trần Thái Tông, P. Dịch Vọng, Q. Cầu Giấy, TP. Hà Nội
                <br>
                <i class="fa-solid fa-mobile-screen-button" style="color: #ffffff;"></i>
                <a href="#">0905985781</a>
                <br>
                <i class="fa-solid fa-envelope" style="color: #ffffff;"></i>
                <a href="mailto:info@anhhoabakery.vn">info@anhhoabakery.vn</a>
            </div>
            <div class="col-lg-2">
                <h3><i>ChÍNH SÁCH</i></h3>
                <br>
                <br>
                <a href="#">Chính sách và quy định chung</a>
                <br>
                <br>
                <a href="#">Chính sách giao dịch && Thanh toán</a>
                <br>
                <br>
                <a href="#">Chính sách đổi Trải</a>
                <br>
                <br>
                <a href="#">Chính sách bảo mật</a>
            </div>
            <div class="col-lg-3">
                <h3><i>ANH HOÀ BARKEY</i></h3>
                <br>
                <p>
                    Tên đơn vị: Công ty Cổ phần Bánh ngọt Anh Hòa
                    Số giấy chứng nhận đăng ký kinh doanh: 0104802706
                    Ngày cấp: 21/07/2010
                    Nơi cấp: Sở Kế hoạch và Đầu tư Tp. Hà Nội
                </p>
                <br>
                <input type="email" required="" value="" placeholder="Nhập email của bạn..." name="contact[email]"
                    id="Email" class="input-group-field" aria-label="email@example.com">
                <a href="#"><i class="fa-solid fa-paper-plane" style="color: #ffffff;"></i></a>
            </div>
            <div class="col-lg-3">
                <h4>
                    Mỗi tháng chúng tôi đều có những đợt giảm giá dịch vụ và sản phẩm nhằm tri ân khách hàng. Để có thể
                    cập nhật kịp thời những đợt giảm giá này, vui lòng nhập địa chỉ email của bạn vào ô dưới đây
                </h4>
                <img src="./images/footer_01.webp">
            </div>
            <div class="col-lg-1">

            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
        integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
        integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
        crossorigin="anonymous"></script>
    <script src="indexUsers.js"></script>
    <script>


        const url = new URL(document.URL);
        const idProduct = url.searchParams.get("idProduct")
        console.log(typeof idProduct);
        // renđer sản phẩm
        const dataCake = JSON.parse(localStorage.getItem("product"));
        const renderCake = document.querySelector('.reviewProduct');

        let productById = {};
        productById = dataCake.find((item) => {
            return item.id === Number(idProduct)
        })
        console.log(productById);
        let detailProduct = ""
        detailProduct = `<div class="reviewProduct">
        <div>
            <div class="product-img">
                <img src="${productById.avt_image}" alt="" width="90%">
            </div>
        </div>
        <div>
            <h3>${productById.name}</h3>
            <p>${productById.id}</p>
            <p>${productById.price}<sup>đ</sup></p>
            <div id="buy-amount">
                <input
                type="number"
                min="1"
                value="1"
                id="number-product"
              />
              
                
            </div>
            <button class="btn-button" id="add-cart"  onclick="handleAddToCart(${productById.id})">Thêm vào giỏ hàng</button>
            <button class="btn-button-1">MUA NGAY</button>
           
            <div id="reviewCMT">
                <br>
                <a href="#">Mô tả chung</a>

                <p>- GATO</p>
                <p> - CARAMEL SOCOLA</p>
                <p></p> BÁNH ĐƯỢC LÀM TỪ 3 LỚP GATO KẾT HỢP VỚI LỚP CREAM CHEESE, CHANH LEO và CHOCOLATE . PHỦ MẶT BÁNH
                1</p>
                <p> LỚP SỐT CARAMEL VÀ TRANG TRÍ HOA QUẢ.</p>

            </div>

        </div>

    </div>`


        renderCake.innerHTML = detailProduct;

        // 
        function handleAddToCart() {
            const countProduct = document.querySelector("#number-product").value;
            const userLoginDB = JSON.parse(localStorage.getItem("userLogin"));

            const userDB = JSON.parse(localStorage.getItem("accounts")) ?? [];
            const productDB = JSON.parse(localStorage.getItem("product")) ?? [];
            if (userLoginDB == null) {
                window.location = "login.html";
            } else {
                let producted;
                productDB.forEach((product) => {
                    if (product.id == idProduct) {
                        producted = product;
                        producted.quantity = countProduct;
                        
                    }

                });
                console.log(22, producted);
                let indexUser;
                let oldCart = [];
                userDB.forEach((user, index) => {
                    if (user.email !== userLoginDB.email) {
                        oldCart = user.cart;
                        indexUser = index;
                        console.log("cart", user.cart);
                        return;
                    }
                    if(!user.cart) {
                        userDB[index].cart = [producted]
                    } else {
                        let isdublicate = false
                        user.cart.forEach((product,index1) => {
                            if (product.id === producted.id) {
                                isdublicate = true
                                product.quantity++
                            } 
                        })
                        if (!isdublicate) {
                          userDB[index].cart.push(producted)
                        }
  
                    }
                    })
                    localStorage.setItem("accounts", JSON.stringify(userDB));
            }
        }


    </script>
</body>

</html>